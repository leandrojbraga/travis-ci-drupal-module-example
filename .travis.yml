language: php
dist: trusty
sudo: required
php:
- 5.6

mysql:
  database: travis_ci_drupal_module_example_test
  username: root
  encoding: utf8
addons:
  apt:
    update: true
install:
- sudo apt-get install -y --force-yes php5-cgi php5-mysql
- export PATH="$HOME/.config/composer/vendor/bin:$PATH"
- composer global require drush/drush:6.*
before_script:
- cd ../..
- mysql -e 'create database travis_ci_drupal_module_example_test'
- php -d sendmail_path=`which true` ~/.config/composer/vendor/bin/drush.php --yes
  core-quick-drupal --profile=testing --no-server --db-url=mysql://root:@127.0.0.1/travis_ci_drupal_module_example_test
  --enable=simpletest travis_ci_drupal_module_example_test
- ln -s $(readlink -e $(cd -)) travis_ci_drupal_module_example_test/drupal/sites/all/modules/travis_ci_drupal_module_example
- cd travis_ci_drupal_module_example_test/drupal
- drush --yes pm-enable travis_ci_drupal_module_example
- drush runserver 127.0.0.1:8080 &
- until netstat -an 2>/dev/null | grep '8080.*LISTEN'; do true; done
script: drush test-run 'Travis-CI Drupal Module Example' --uri=http://127.0.0.1:8080
deploy:
  provider: heroku
  api_key:
    secure: O09MjlJ8wZy+toIvndA5XP3dMvCC9nc6+n6XX5+QVbtZV+omvpxw92lgzdHprsMN+l3zImN1/pEzXP+s6cH2/MpbRiVsgrwIOwLs5ARDJ+v1U14uHy83Xx07WATlYz3HF1Xw59LvPnV3zBD42YZFpP9oo/uOODiujqz+S6H5peypmDZDb8pSR3gzYLw8uKMSGZW/BdFhgzWHczM2Lmu6hrbjINuw5188oye4SD4kBUQvmn8yiDcwmH2xivOd5+i7qFpfgBQpxicVH1b6742I3WkcGrTrX0nHb5tTlLVA4dWcuQqYID53b8QZU28MXcoRRi4ZWgT2Lj+1nRLIsMwjK2VCGDs0GRoTLpQf2IFoyW6xWejQlzkMtTWs455TzCiaF1ySTmOv2ffmOHOnVlWwqRnbXqW380NdRuKpq9CMk8M8QW+BU9JWyido57eNnr4oodxmmS/BIgRGOkGM8SfIbHxf3yasgwdcbOeKZNhOPWcTTSYxyPkFlSYYHTzZj9eY87EArjP0RtedvU97UPz0MjcWaDECcD8x5utiYgLm9zFxXo/XsgbRFnTv+Z384X5fz2TCg2dJEKbcYHL37FdTLCQ9ocAAYsnmFXgQa3qlwURNB5z29WusFcLwSsD4G3BIcdjy2QIUuIgIFHNcbnJwIQjY1mwiqUcsTTAV4pCL0yw=
  app: travis-deploy-drupal
